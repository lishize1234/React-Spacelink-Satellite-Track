{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\lishi\\\\my-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Geographies,Geography,Graticule,Sphere,ComposableMap,Marker,Line}from\"react-simple-maps\";import{Button,InputNumber,Progress}from\"antd\";import{NY20_API_KEY,NY20_BASE_URL,COLOR}from\"../constants\";export var POSITION_API_BASE_URL=\"\".concat(NY20_BASE_URL,\"/positions\");var progressStatus={Idle:'Idle',Tracking:'Tracking...',Complete:'Complete'};var geoUrl=\"https://raw.githubusercontent.com/zcreativelabs/react-simple-maps/master/topojson-maps/world-110m.json\";var WorldMap=function WorldMap(_ref){var selectedSatellites=_ref.selectedSatellites,disabled=_ref.disabled,onTracking=_ref.onTracking,observerInfo=_ref.observerInfo,initialValues=_ref.initialValues;var _useState=useState(1),_useState2=_slicedToArray(_useState,2),duration=_useState2[0],setDuration=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),progressPercentage=_useState4[0],setProgressPercentage=_useState4[1];var _useState5=useState(progressStatus.Idle),_useState6=_slicedToArray(_useState5,2),progressText=_useState6[0],setProgressText=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),timerId=_useState8[0],setTimerId=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),markersInfo=_useState10[0],setMarkersInfo=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),currentTimestamp=_useState12[0],setCurrentTimestamp=_useState12[1];var abortOnClick=function abortOnClick(){if(timerId){clearInterval(timerId);setProgressPercentage(0);setProgressText(progressStatus.Idle);onTracking(false);setTimerId(undefined);}};var fetchPositions=function fetchPositions(){var longitude=observerInfo.longitude,latitude=observerInfo.latitude,altitude=observerInfo.altitude;return selectedSatellites.map(function(sat){var id=sat.satid;return fetch(\"\".concat(POSITION_API_BASE_URL,\"/\").concat(id,\"/\").concat(latitude,\"/\").concat(longitude,\"/\").concat(altitude,\"/\").concat(duration*60,\"&apiKey=\").concat(NY20_API_KEY)).then(function(response){return response.json();});});};var updateMarker=function updateMarker(data,index){setMarkersInfo(data.map(function(sat){return{startLon:sat.positions[0].satlongitude,startLat:sat.positions[0].satlatitude,midLon:sat.positions[Math.floor(index/2)].satlongitude,midLat:sat.positions[Math.floor(index/2)].satlatitude,lon:sat.positions[index].satlongitude,lat:sat.positions[index].satlatitude,name:sat.info.satname};}));};var startTracking=function startTracking(data){var index=59;var end=data[0].positions.length-1;setCurrentTimestamp(new Date(data[0].positions[index].timestamp*1000).toString());setProgressPercentage(index/end*100);updateMarker(data,index);var timerId=setInterval(function(){index+=60;if(index>=end){setProgressText(progressStatus.Complete);setProgressPercentage(index/end*100);setTimerId(undefined);onTracking(false);clearInterval(timerId);return;}setProgressPercentage(index/end*100);updateMarker(data,index);setCurrentTimestamp(new Date(data[0].positions[index].timestamp*1000).toString());},1000);return timerId;};var trackOnClick=function trackOnClick(){setProgressText(progressStatus.Tracking);setProgressPercentage(0);onTracking(true);Promise.all(fetchPositions()).then(function(data){var id=startTracking(data);setTimerId(id);}).catch(function(){console.log(\"error\");});};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"track-info-panel\"},/*#__PURE__*/React.createElement(Button,{type:\"primary\",onClick:trackOnClick,disabled:selectedSatellites.length===0||disabled,\"background-color\":\"#108ee9\"},\"Track selected satellite(s)\"),/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:\"10px\",marginRight:\"10px\"}},\"for\"),/*#__PURE__*/React.createElement(InputNumber,{min:1,max:59,defaultValue:1,onChange:function onChange(value){return setDuration(value);},disabled:disabled}),/*#__PURE__*/React.createElement(\"span\",{style:{marginLeft:\"10px\",marginRight:\"30px\"}},\"minutes (1 ~ 59)\"),/*#__PURE__*/React.createElement(Progress,{style:{width:\"500px\",marginRight:\"150px\"},percent:progressPercentage,format:function format(){return progressText;},strokeColor:{from:'#108ee9',to:'#87d068'}}),timerId&&/*#__PURE__*/React.createElement(Button,{type:\"primary\",onClick:abortOnClick},\"Abort\")),/*#__PURE__*/React.createElement(\"div\",{className:\"time-stamp-container\",style:{textAlign:\"center\"}},/*#__PURE__*/React.createElement(\"b\",null,currentTimestamp)),/*#__PURE__*/React.createElement(ComposableMap,{projectionConfig:{scale:140},height:480,style:{width:\"95%\",marginLeft:\"10px\"}},/*#__PURE__*/React.createElement(Graticule,{stroke:\"#FFB6C1\",strokeWidth:0.5}),/*#__PURE__*/React.createElement(Sphere,{stroke:\"#FFB6C1\",strokeWidth:0.5}),/*#__PURE__*/React.createElement(Geographies,{geography:geoUrl},function(_ref2){var geographies=_ref2.geographies;return geographies.map(function(geo){return/*#__PURE__*/React.createElement(Geography,{key:geo.rsmKey,geography:geo,fill:\"#c0d6e4\",stroke:\"#FFF\"});});}),initialValues.longitude&&initialValues.latitude?/*#__PURE__*/React.createElement(Marker,{coordinates:[initialValues.longitude,initialValues.latitude]},/*#__PURE__*/React.createElement(\"circle\",{r:3,fill:\"#F53\"}),/*#__PURE__*/React.createElement(\"text\",null,\"Observer\")):null,markersInfo.map(function(mark,index){return/*#__PURE__*/React.createElement(Line,{coordinates:[[mark.startLon,mark.startLat],[mark.midLon,mark.midLat],[mark.lon,mark.lat]],stroke:index<COLOR.length?COLOR[index]:COLOR[COLOR.length-1],strokeWidth:2,strokeLinecap:\"round\"});}),markersInfo.map(function(mark,index){return/*#__PURE__*/React.createElement(Marker,{coordinates:[mark.lon,mark.lat]},/*#__PURE__*/React.createElement(\"circle\",{r:4,fill:index<COLOR.length?COLOR[index]:COLOR[COLOR.length-1]}),/*#__PURE__*/React.createElement(\"text\",{\"text-anchor\":\"middle\",x:mark.Lon>mark.startLon?\"10\":\"20\",y:\"20\",fill:\"#0c66a7\"},mark.name));}),markersInfo.map(function(mark,index){return/*#__PURE__*/React.createElement(Marker,{coordinates:[mark.startLon,mark.startLat]},/*#__PURE__*/React.createElement(\"circle\",{r:3,fill:index<COLOR.length?COLOR[index]:COLOR[COLOR.length-1]}));})));};export default WorldMap;","map":{"version":3,"sources":["C:/Users/lishi/my-app/src/components/WorldMap.js"],"names":["React","useState","Geographies","Geography","Graticule","Sphere","ComposableMap","Marker","Line","Button","InputNumber","Progress","NY20_API_KEY","NY20_BASE_URL","COLOR","POSITION_API_BASE_URL","progressStatus","Idle","Tracking","Complete","geoUrl","WorldMap","selectedSatellites","disabled","onTracking","observerInfo","initialValues","duration","setDuration","progressPercentage","setProgressPercentage","progressText","setProgressText","undefined","timerId","setTimerId","markersInfo","setMarkersInfo","currentTimestamp","setCurrentTimestamp","abortOnClick","clearInterval","fetchPositions","longitude","latitude","altitude","map","sat","id","satid","fetch","then","response","json","updateMarker","data","index","startLon","positions","satlongitude","startLat","satlatitude","midLon","Math","floor","midLat","lon","lat","name","info","satname","startTracking","end","length","Date","timestamp","toString","setInterval","trackOnClick","Promise","all","catch","console","log","marginLeft","marginRight","value","width","from","to","textAlign","scale","geographies","geo","rsmKey","mark","Lon"],"mappings":"oJAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,OACEC,WADF,CAEEC,SAFF,CAGEC,SAHF,CAIEC,MAJF,CAKEC,aALF,CAMEC,MANF,CAOEC,IAPF,KAQO,mBARP,CASA,OAASC,MAAT,CAAiBC,WAAjB,CAA8BC,QAA9B,KAA8C,MAA9C,CACA,OAASC,YAAT,CAAuBC,aAAvB,CAAsCC,KAAtC,KAAmD,cAAnD,CAEA,MAAO,IAAMC,CAAAA,qBAAqB,WAAMF,aAAN,cAA3B,CAEP,GAAMG,CAAAA,cAAc,CAAG,CACrBC,IAAI,CAAE,MADe,CAErBC,QAAQ,CAAE,aAFW,CAGrBC,QAAQ,CAAE,UAHW,CAAvB,CAMA,GAAMC,CAAAA,MAAM,CACV,wGADF,CAGA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,MAMX,IALJC,CAAAA,kBAKI,MALJA,kBAKI,CAJJC,QAII,MAJJA,QAII,CAHJC,UAGI,MAHJA,UAGI,CAFJC,YAEI,MAFJA,YAEI,CADJC,aACI,MADJA,aACI,eAC4BzB,QAAQ,CAAC,CAAD,CADpC,wCACG0B,QADH,eACaC,WADb,8BAEgD3B,QAAQ,CAAC,CAAD,CAFxD,yCAEG4B,kBAFH,eAEuBC,qBAFvB,8BAGoC7B,QAAQ,CAACe,cAAc,CAACC,IAAhB,CAH5C,yCAGGc,YAHH,eAGiBC,eAHjB,8BAI0B/B,QAAQ,CAACgC,SAAD,CAJlC,yCAIGC,OAJH,eAIYC,UAJZ,8BAKkClC,QAAQ,CAAC,EAAD,CAL1C,0CAKGmC,WALH,gBAKgBC,cALhB,gCAM4CpC,QAAQ,CAAC,EAAD,CANpD,2CAMGqC,gBANH,gBAMqBC,mBANrB,gBAQJ,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzB,GAAIN,OAAJ,CAAa,CACXO,aAAa,CAACP,OAAD,CAAb,CACAJ,qBAAqB,CAAC,CAAD,CAArB,CACAE,eAAe,CAAChB,cAAc,CAACC,IAAhB,CAAf,CACAO,UAAU,CAAC,KAAD,CAAV,CACAW,UAAU,CAACF,SAAD,CAAV,CACD,CACF,CARD,CAUA,GAAMS,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,IACnBC,CAAAA,SADmB,CACelB,YADf,CACnBkB,SADmB,CACRC,QADQ,CACenB,YADf,CACRmB,QADQ,CACEC,QADF,CACepB,YADf,CACEoB,QADF,CAG3B,MAAOvB,CAAAA,kBAAkB,CAACwB,GAAnB,CAAuB,SAACC,GAAD,CAAS,CACrC,GAAMC,CAAAA,EAAE,CAAGD,GAAG,CAACE,KAAf,CACA,MAAOC,CAAAA,KAAK,WAAInC,qBAAJ,aAA6BiC,EAA7B,aAAmCJ,QAAnC,aAA+CD,SAA/C,aAA4DE,QAA5D,aAAwElB,QAAQ,CAAG,EAAnF,oBAAgGf,YAAhG,EAAL,CACJuC,IADI,CACC,SAAAC,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADT,CAAP,CAED,CAJM,CAAP,CAKD,CARD,CAUA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,IAAD,CAAOC,KAAP,CAAiB,CACpCnB,cAAc,CAACkB,IAAI,CAACT,GAAL,CAAS,SAACC,GAAD,CAAS,CAC/B,MAAO,CACLU,QAAQ,CAAEV,GAAG,CAACW,SAAJ,CAAc,CAAd,EAAiBC,YADtB,CAELC,QAAQ,CAAEb,GAAG,CAACW,SAAJ,CAAc,CAAd,EAAiBG,WAFtB,CAGLC,MAAM,CAAEf,GAAG,CAACW,SAAJ,CAAcK,IAAI,CAACC,KAAL,CAAWR,KAAK,CAAG,CAAnB,CAAd,EAAqCG,YAHxC,CAILM,MAAM,CAAElB,GAAG,CAACW,SAAJ,CAAcK,IAAI,CAACC,KAAL,CAAWR,KAAK,CAAG,CAAnB,CAAd,EAAqCK,WAJxC,CAKLK,GAAG,CAAEnB,GAAG,CAACW,SAAJ,CAAcF,KAAd,EAAqBG,YALrB,CAMLQ,GAAG,CAAEpB,GAAG,CAACW,SAAJ,CAAcF,KAAd,EAAqBK,WANrB,CAOLO,IAAI,CAAErB,GAAG,CAACsB,IAAJ,CAASC,OAPV,CAAP,CASD,CAVc,CAAD,CAAd,CAWD,CAZD,CAcA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAChB,IAAD,CAAU,CAC9B,GAAIC,CAAAA,KAAK,CAAG,EAAZ,CACA,GAAIgB,CAAAA,GAAG,CAAGjB,IAAI,CAAC,CAAD,CAAJ,CAAQG,SAAR,CAAkBe,MAAlB,CAA2B,CAArC,CAEAlC,mBAAmB,CAAC,GAAImC,CAAAA,IAAJ,CAASnB,IAAI,CAAC,CAAD,CAAJ,CAAQG,SAAR,CAAkBF,KAAlB,EAAyBmB,SAAzB,CAAqC,IAA9C,EAAoDC,QAApD,EAAD,CAAnB,CACA9C,qBAAqB,CAAE0B,KAAK,CAAGgB,GAAT,CAAgB,GAAjB,CAArB,CACAlB,YAAY,CAACC,IAAD,CAAOC,KAAP,CAAZ,CACA,GAAMtB,CAAAA,OAAO,CAAI2C,WAAW,CAAC,UAAM,CACjCrB,KAAK,EAAI,EAAT,CACA,GAAIA,KAAK,EAAIgB,GAAb,CAAkB,CAChBxC,eAAe,CAAChB,cAAc,CAACG,QAAhB,CAAf,CACAW,qBAAqB,CAAE0B,KAAK,CAAGgB,GAAT,CAAgB,GAAjB,CAArB,CACArC,UAAU,CAACF,SAAD,CAAV,CACAT,UAAU,CAAC,KAAD,CAAV,CACAiB,aAAa,CAACP,OAAD,CAAb,CACA,OACD,CACDJ,qBAAqB,CAAE0B,KAAK,CAAGgB,GAAT,CAAgB,GAAjB,CAArB,CACAlB,YAAY,CAACC,IAAD,CAAOC,KAAP,CAAZ,CACAjB,mBAAmB,CAAC,GAAImC,CAAAA,IAAJ,CAASnB,IAAI,CAAC,CAAD,CAAJ,CAAQG,SAAR,CAAkBF,KAAlB,EAAyBmB,SAAzB,CAAqC,IAA9C,EAAoDC,QAApD,EAAD,CAAnB,CAGD,CAf2B,CAezB,IAfyB,CAA5B,CAiBA,MAAO1C,CAAAA,OAAP,CACD,CAzBD,CA2BA,GAAM4C,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzB9C,eAAe,CAAChB,cAAc,CAACE,QAAhB,CAAf,CACAY,qBAAqB,CAAC,CAAD,CAArB,CACAN,UAAU,CAAC,IAAD,CAAV,CAEAuD,OAAO,CAACC,GAAR,CAAYtC,cAAc,EAA1B,EAA8BS,IAA9B,CAAmC,SAACI,IAAD,CAAU,CAC3C,GAAMP,CAAAA,EAAE,CAAGuB,aAAa,CAAChB,IAAD,CAAxB,CACApB,UAAU,CAACa,EAAD,CAAV,CACD,CAHD,EAGGiC,KAHH,CAGS,UAAM,CACbC,OAAO,CAACC,GAAR,CAAY,OAAZ,EACD,CALD,EAMD,CAXD,CAaA,mBACE,qDACE,2BAAK,SAAS,CAAC,kBAAf,eACE,oBAAC,MAAD,EACE,IAAI,CAAC,SADP,CAEE,OAAO,CAAEL,YAFX,CAGE,QAAQ,CAAExD,kBAAkB,CAACmD,MAAnB,GAA8B,CAA9B,EAAmClD,QAH/C,CAIE,mBAAmB,SAJrB,gCADF,cAUE,4BAAM,KAAK,CAAE,CAAE6D,UAAU,CAAE,MAAd,CAAsBC,WAAW,CAAE,MAAnC,CAAb,QAVF,cAWE,oBAAC,WAAD,EACE,GAAG,CAAE,CADP,CAEE,GAAG,CAAE,EAFP,CAGE,YAAY,CAAE,CAHhB,CAIE,QAAQ,CAAE,kBAACC,KAAD,QAAW1D,CAAAA,WAAW,CAAC0D,KAAD,CAAtB,EAJZ,CAKE,QAAQ,CAAE/D,QALZ,EAXF,cAkBE,4BAAM,KAAK,CAAE,CAAE6D,UAAU,CAAE,MAAd,CAAsBC,WAAW,CAAE,MAAnC,CAAb,qBAlBF,cAmBE,oBAAC,QAAD,EACE,KAAK,CAAE,CAAEE,KAAK,CAAE,OAAT,CAAkBF,WAAW,CAAE,OAA/B,CADT,CAEE,OAAO,CAAExD,kBAFX,CAGE,MAAM,CAAE,wBAAME,CAAAA,YAAN,EAHV,CAIE,WAAW,CAAE,CACXyD,IAAI,CAAE,SADK,CAEXC,EAAE,CAAE,SAFO,CAJf,EAnBF,CA4BGvD,OAAO,eACN,oBAAC,MAAD,EACE,IAAI,CAAC,SADP,CAEE,OAAO,CAAEM,YAFX,UA7BJ,CADF,cAsCE,2BAAK,SAAS,CAAC,sBAAf,CAAsC,KAAK,CAAE,CAACkD,SAAS,CAAE,QAAZ,CAA7C,eACE,6BAAIpD,gBAAJ,CADF,CAtCF,cAyCE,oBAAC,aAAD,EAAe,gBAAgB,CAAE,CAAEqD,KAAK,CAAE,GAAT,CAAjC,CAAiD,MAAM,CAAI,GAA3D,CAAgE,KAAK,CAAE,CAAEJ,KAAK,CAAE,KAAT,CAAgBH,UAAU,CAAE,MAA5B,CAAvE,eACE,oBAAC,SAAD,EAAW,MAAM,CAAE,SAAnB,CAA6B,WAAW,CAAE,GAA1C,EADF,cAEE,oBAAC,MAAD,EAAQ,MAAM,CAAC,SAAf,CAAyB,WAAW,CAAE,GAAtC,EAFF,cAGE,oBAAC,WAAD,EAAa,SAAS,CAAEhE,MAAxB,EACG,mBAAGwE,CAAAA,WAAH,OAAGA,WAAH,OACCA,CAAAA,WAAW,CAAC9C,GAAZ,CAAgB,SAAA+C,GAAG,qBACjB,oBAAC,SAAD,EACE,GAAG,CAAEA,GAAG,CAACC,MADX,CAEE,SAAS,CAAED,GAFb,CAGE,IAAI,CAAC,SAHP,CAIE,MAAM,CAAC,MAJT,EADiB,EAAnB,CADD,EADH,CAHF,CAgBInE,aAAa,CAACiB,SAAd,EAA2BjB,aAAa,CAACkB,QAAzC,cACA,oBAAC,MAAD,EAAQ,WAAW,CAAE,CAAClB,aAAa,CAACiB,SAAf,CAA0BjB,aAAa,CAACkB,QAAxC,CAArB,eACE,8BAAQ,CAAC,CAAE,CAAX,CAAc,IAAI,CAAC,MAAnB,EADF,cAEE,2CAFF,CADA,CAIY,IApBhB,CAuBIR,WAAW,CAACU,GAAZ,CAAgB,SAACiD,IAAD,CAAOvC,KAAP,qBACd,oBAAC,IAAD,EACI,WAAW,CAAE,CAAC,CAACuC,IAAI,CAACtC,QAAN,CAAgBsC,IAAI,CAACnC,QAArB,CAAD,CAAiC,CAACmC,IAAI,CAACjC,MAAN,CAAciC,IAAI,CAAC9B,MAAnB,CAAjC,CAA6D,CAAC8B,IAAI,CAAC7B,GAAN,CAAW6B,IAAI,CAAC5B,GAAhB,CAA7D,CADjB,CAEI,MAAM,CAAEX,KAAK,CAAG1C,KAAK,CAAC2D,MAAd,CAAuB3D,KAAK,CAAC0C,KAAD,CAA5B,CAAsC1C,KAAK,CAACA,KAAK,CAAC2D,MAAN,CAAe,CAAhB,CAFvD,CAGI,WAAW,CAAE,CAHjB,CAII,aAAa,CAAC,OAJlB,EADc,EAAhB,CAvBJ,CAiCKrC,WAAW,CAACU,GAAZ,CAAgB,SAACiD,IAAD,CAAOvC,KAAP,qBAChB,oBAAC,MAAD,EAAQ,WAAW,CAAE,CAACuC,IAAI,CAAC7B,GAAN,CAAW6B,IAAI,CAAC5B,GAAhB,CAArB,eACI,8BAAQ,CAAC,CAAE,CAAX,CAAc,IAAI,CAAEX,KAAK,CAAG1C,KAAK,CAAC2D,MAAd,CAAuB3D,KAAK,CAAC0C,KAAD,CAA5B,CAAsC1C,KAAK,CAACA,KAAK,CAAC2D,MAAN,CAAe,CAAhB,CAA/D,EADJ,cAEI,4BAAM,cAAY,QAAlB,CACI,CAAC,CAAEsB,IAAI,CAACC,GAAL,CAAWD,IAAI,CAACtC,QAAhB,CAA2B,IAA3B,CAAkC,IADzC,CAC+C,CAAC,CAAC,IADjD,CACsD,IAAI,CAAC,SAD3D,EACsEsC,IAAI,CAAC3B,IAD3E,CAFJ,CADgB,EAAhB,CAjCL,CA0CIhC,WAAW,CAACU,GAAZ,CAAgB,SAACiD,IAAD,CAAOvC,KAAP,qBAChB,oBAAC,MAAD,EAAQ,WAAW,CAAE,CAACuC,IAAI,CAACtC,QAAN,CAAgBsC,IAAI,CAACnC,QAArB,CAArB,eACI,8BAAQ,CAAC,CAAE,CAAX,CAAc,IAAI,CAAEJ,KAAK,CAAG1C,KAAK,CAAC2D,MAAd,CAAuB3D,KAAK,CAAC0C,KAAD,CAA5B,CAAsC1C,KAAK,CAACA,KAAK,CAAC2D,MAAN,CAAe,CAAhB,CAA/D,EADJ,CADgB,EAAhB,CA1CJ,CAzCF,CADF,CA6FD,CArLD,CAuLA,cAAepD,CAAAA,QAAf","sourcesContent":["import React, { useState } from \"react\";\r\nimport {\r\n  Geographies,\r\n  Geography,\r\n  Graticule,\r\n  Sphere,\r\n  ComposableMap,\r\n  Marker,\r\n  Line\r\n} from \"react-simple-maps\";\r\nimport { Button, InputNumber, Progress } from \"antd\";\r\nimport { NY20_API_KEY, NY20_BASE_URL, COLOR } from \"../constants\";\r\n\r\nexport const POSITION_API_BASE_URL = `${NY20_BASE_URL}/positions`;\r\n\r\nconst progressStatus = {\r\n  Idle: 'Idle',\r\n  Tracking: 'Tracking...',\r\n  Complete: 'Complete'\r\n}\r\n\r\nconst geoUrl =\r\n  \"https://raw.githubusercontent.com/zcreativelabs/react-simple-maps/master/topojson-maps/world-110m.json\";\r\n\r\nconst WorldMap = ({\r\n  selectedSatellites,\r\n  disabled,\r\n  onTracking,\r\n  observerInfo,\r\n  initialValues\r\n}) => {\r\n  const [duration, setDuration] = useState(1);\r\n  const [progressPercentage, setProgressPercentage] = useState(0);\r\n  const [progressText, setProgressText] = useState(progressStatus.Idle);\r\n  const [timerId, setTimerId] = useState(undefined);\r\n  const [markersInfo, setMarkersInfo] = useState([]);\r\n  const [currentTimestamp, setCurrentTimestamp] = useState('');\r\n\r\n  const abortOnClick = () => {\r\n    if (timerId) {\r\n      clearInterval(timerId);\r\n      setProgressPercentage(0);\r\n      setProgressText(progressStatus.Idle);\r\n      onTracking(false);\r\n      setTimerId(undefined);\r\n    }\r\n  }\r\n\r\n  const fetchPositions = () => {\r\n    const { longitude, latitude, altitude } = observerInfo;\r\n\r\n    return selectedSatellites.map((sat) => {\r\n      const id = sat.satid;\r\n      return fetch(`${POSITION_API_BASE_URL}/${id}/${latitude}/${longitude}/${altitude}/${duration * 60}&apiKey=${NY20_API_KEY}`)\r\n        .then(response => response.json());\r\n    })\r\n  }\r\n\r\n  const updateMarker = (data, index) => {\r\n    setMarkersInfo(data.map((sat) => {\r\n      return {\r\n        startLon: sat.positions[0].satlongitude,\r\n        startLat: sat.positions[0].satlatitude,\r\n        midLon: sat.positions[Math.floor(index / 2)].satlongitude,\r\n        midLat: sat.positions[Math.floor(index / 2)].satlatitude,\r\n        lon: sat.positions[index].satlongitude,\r\n        lat: sat.positions[index].satlatitude,\r\n        name: sat.info.satname,\r\n      };\r\n    }))\r\n  }\r\n\r\n  const startTracking = (data) => {\r\n    let index = 59;\r\n    let end = data[0].positions.length - 1;\r\n    \r\n    setCurrentTimestamp(new Date(data[0].positions[index].timestamp * 1000).toString());\r\n    setProgressPercentage((index / end) * 100);\r\n    updateMarker(data, index);\r\n    const timerId =  setInterval(() => {\r\n      index += 60;\r\n      if (index >= end) {\r\n        setProgressText(progressStatus.Complete);\r\n        setProgressPercentage((index / end) * 100);\r\n        setTimerId(undefined);\r\n        onTracking(false);\r\n        clearInterval(timerId);\r\n        return;\r\n      }\r\n      setProgressPercentage((index / end) * 100);\r\n      updateMarker(data, index);\r\n      setCurrentTimestamp(new Date(data[0].positions[index].timestamp * 1000).toString());\r\n\r\n\r\n    }, 1000);\r\n\r\n    return timerId;\r\n  }\r\n\r\n  const trackOnClick = () => {\r\n    setProgressText(progressStatus.Tracking);\r\n    setProgressPercentage(0);\r\n    onTracking(true);\r\n\r\n    Promise.all(fetchPositions()).then((data) => {\r\n      const id = startTracking(data);\r\n      setTimerId(id);\r\n    }).catch(() => {\r\n      console.log(\"error\");\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"track-info-panel\">\r\n        <Button \r\n          type=\"primary\"\r\n          onClick={trackOnClick}\r\n          disabled={selectedSatellites.length === 0 || disabled}\r\n          background-color = '#108ee9'\r\n\r\n        >\r\n          Track selected satellite(s)\r\n        </Button>\r\n        <span style={{ marginLeft: \"10px\", marginRight: \"10px\" }}>for</span>\r\n        <InputNumber \r\n          min={1}\r\n          max={59}\r\n          defaultValue={1}\r\n          onChange={(value) => setDuration(value)}\r\n          disabled={disabled}\r\n        />\r\n        <span style={{ marginLeft: \"10px\", marginRight: \"30px\" }}>minutes (1 ~ 59)</span>\r\n        <Progress \r\n          style={{ width: \"500px\", marginRight: \"150px\" }}\r\n          percent={progressPercentage} \r\n          format={() => progressText} \r\n          strokeColor={{\r\n            from: '#108ee9',\r\n            to: '#87d068',\r\n          }}\r\n        />\r\n        {timerId &&\r\n          <Button \r\n            type=\"primary\"\r\n            onClick={abortOnClick}\r\n          >\r\n            Abort\r\n          </Button>\r\n        }\r\n      </div>\r\n      <div className=\"time-stamp-container\" style={{textAlign: \"center\"}}>\r\n        <b>{currentTimestamp}</b>\r\n      </div>\r\n      <ComposableMap projectionConfig={{ scale: 140 }} height = {480} style={{ width: \"95%\", marginLeft: \"10px\" }}>\r\n        <Graticule stroke= \"#FFB6C1\" strokeWidth={0.5} />\r\n        <Sphere stroke=\"#FFB6C1\" strokeWidth={0.5} />\r\n        <Geographies geography={geoUrl}>\r\n          {({ geographies }) =>\r\n            geographies.map(geo => (\r\n              <Geography\r\n                key={geo.rsmKey}\r\n                geography={geo}\r\n                fill=\"#c0d6e4\"\r\n                stroke=\"#FFF\"\r\n              />\r\n            ))\r\n          }\r\n        </Geographies>\r\n        {\r\n          initialValues.longitude && initialValues.latitude ? \r\n          <Marker coordinates={[initialValues.longitude, initialValues.latitude]}>\r\n            <circle r={3} fill=\"#F53\" />\r\n            <text>Observer</text>\r\n          </Marker> : null\r\n        }\r\n        {\r\n          markersInfo.map((mark, index) =>\r\n            <Line\r\n                coordinates={[[mark.startLon, mark.startLat], [mark.midLon, mark.midLat], [mark.lon, mark.lat]]}\r\n                stroke={index < COLOR.length ? COLOR[index] : COLOR[COLOR.length - 1]}\r\n                strokeWidth={2}\r\n                strokeLinecap=\"round\"\r\n            />\r\n          )\r\n        }\r\n        {\r\n           markersInfo.map((mark, index) =>\r\n           <Marker coordinates={[mark.lon, mark.lat]}>\r\n               <circle r={4} fill={index < COLOR.length ? COLOR[index] : COLOR[COLOR.length - 1]} />\r\n               <text text-anchor=\"middle\"\r\n                   x={mark.Lon > mark.startLon ? \"10\" : \"20\"} y=\"20\" fill=\"#0c66a7\">{mark.name}</text>\r\n           </Marker>\r\n          )\r\n        }\r\n        {\r\n          markersInfo.map((mark, index) =>\r\n          <Marker coordinates={[mark.startLon, mark.startLat]}>\r\n              <circle r={3} fill={index < COLOR.length ? COLOR[index] : COLOR[COLOR.length - 1]} />\r\n          </Marker>\r\n          )\r\n        }\r\n      </ComposableMap>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default WorldMap;"]},"metadata":{},"sourceType":"module"}